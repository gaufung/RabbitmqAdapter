# -*- encoding:utf-8 -*-
import unittest

import redis
from common.redlock import RedLock, RedLockError


class TestRedLock(unittest.TestCase):
    def setUp(self):
        super(TestRedLock, self).setUp()
        self._host = "10.12.6.35"
        self._port = 6380
        self._password = '6Qhq8BeRWE7WYOLqRjhwP233ujB1zSPR'

    def tearDown(self):
        super(TestRedLock, self).tearDown()

    def test_with(self):
        resource = "mysource"
        conn1 = redis.StrictRedis(host=self._host,
                                  port=self._port,
                                  password=self._password,
                                  db=11)
        with RedLock(resource, [conn1]):
            pass

        with RedLock(resource, [conn1]):
            with self.assertRaise(RedLockError)


if __name__ == "__main__":
    unitest.main()
